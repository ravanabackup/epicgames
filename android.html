<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Epic Android Games Finder</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#111; color:#eee; margin:0; padding:20px; }
    h1 { color:#0ff; text-align: center; text-transform: uppercase; letter-spacing: 2px; }
    #status { text-align: center; margin-bottom: 20px; color: #888; }
    #games { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:20px; margin-top:20px; }
    
    .card { 
      background:#1a1a1a; 
      border-radius:12px; 
      overflow:hidden; 
      box-shadow:0 4px 15px rgba(0,0,0,0.6); 
      display:flex; 
      flex-direction:column; 
      border: 1px solid #333;
      transition: transform 0.2s;
    }
    .card:hover { transform: translateY(-5px); border-color: #0ff; }
    
    .thumbnail-container { width: 100%; height: 180px; background: #222; overflow: hidden; }
    .card img.cover { width:100%; height:100%; object-fit:cover; }
    
    .content { padding: 15px; flex-grow: 1; }
    .card h3 { margin: 0 0 10px 0; font-size:1.2rem; color: #fff; }
    .meta { font-size: 12px; color: #888; margin-bottom: 10px; }
    
    .requirements { background: #252525; padding: 10px; border-radius: 6px; margin-bottom: 15px; }
    .requirements strong { font-size: 11px; text-transform: uppercase; color: #0ff; }
    .requirements ul { margin: 5px 0 0 0; padding-left: 18px; font-size: 12px; color: #ccc; }
    
    .footer { padding: 15px; background: #222; border-top: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
    .price { font-weight:bold; color:#0f0; font-size: 1.1rem; }
    .rating-badge { max-height: 30px; }
  </style>
</head>
<body>

  <h1>Epic Android Games</h1>
  <div id="status">Initializing...</div>
  <div id="games"></div>

  <script>
    // Using a CORS proxy to bypass EGS restrictions in the browser
    const API_URL = "https://cors.kawiesh.top/https://egs-platform-service.store.epicgames.com/api/v2/public/discover/home?count=10&country=US&locale=en&platform=android&start=0&store=EGS";

    async function loadGames() {
      try {
        const statusEl = document.getElementById("status");
        statusEl.textContent = "Connecting to Epic Games Store...";
        
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error("Failed to fetch data");
        const data = await res.json();

        const items = [];
        
        // Deep collection logic
        function collect(node) {
          if (!node) return;
          if (Array.isArray(node)) {
            node.forEach(collect);
          } else if (typeof node === "object") {
            // Check if this object is a game entry
            if (node.title && node.systemSpecs) {
              const content = node.content || {};
              const media = content.media || {};
              const purchaseArray = content.purchase || [];
              const ageObj = content.ageRating?.ageRating || {};

              // 1. Get Price Logic
              let priceDisplay = "N/A";
              if (purchaseArray.length > 0) {
                // Find the first item with a priceDisplay or default to first purchase
                const pInfo = purchaseArray.find(p => p.priceDisplay) || purchaseArray[0];
                priceDisplay = pInfo.priceDisplay || (pInfo.price?.decimalPrice === 0 ? "FREE" : "Paid");
              }

              // 2. Get Thumbnail (Cover Image) Logic
              const coverImg = media.coverImage?.imageSrc || media.appIcon?.imageSrc || 'https://via.placeholder.com/300x180?text=No+Image';

              items.push({
                title: node.title,
                platform: node.systemSpecs.platform || "Android",
                requirements: node.systemSpecs.systemRequirements || [],
                version: node.systemSpecs.applicationVersion || "Latest",
                ageTitle: ageObj.title || "Not Rated",
                ratingImage: ageObj.ratingImage || ageObj.rectangularRatingImage || null,
                cover: coverImg,
                price: priceDisplay,
              });
            }
            Object.values(node).forEach(collect);
          }
        }

        collect(data);

        const container = document.getElementById("games");
        container.innerHTML = "";
        
        if (items.length === 0) {
            statusEl.textContent = "No games found for this platform.";
            return;
        }

        items.forEach(it => {
          const card = document.createElement("div");
          card.className = "card";
          
          card.innerHTML = `
            <div class="thumbnail-container">
                <img src="${it.cover}" alt="${it.title}" class="cover">
            </div>
            <div class="content">
                <h3>${it.title}</h3>
                <div class="meta">Platform: ${it.platform} â€¢ Version: ${it.version}</div>
                
                <div class="requirements">
                  <strong>Minimum Requirements</strong>
                  <ul>
                    ${it.requirements.length > 0 
                      ? it.requirements.map(r => `<li>${r.title}: ${r.minimum}</li>`).join("") 
                      : "<li>Check app page for details</li>"}
                  </ul>
                </div>
            </div>
            <div class="footer">
                <div class="price">${it.price}</div>
                ${it.ratingImage ? `<img src="${it.ratingImage}" class="rating-badge" title="${it.ageTitle}">` : `<small>${it.ageTitle}</small>`}
            </div>
          `;
          container.appendChild(card);
        });

        statusEl.textContent = `Displaying ${items.length} titles currently available on Epic Games (Android)`;
      } catch (err) {
        document.getElementById("status").textContent = "Error: " + err.message;
        console.error(err);
      }
    }

    loadGames();
  </script>
</body>
</html>
